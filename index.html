<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playlist Editor</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <nav class="tabs">
            <a href="index.html">Home</a>
            <a href="playlist.html">Playlists</a>
            <a href="track.html">Tracks</a>
            <a href="admin.html">AdminPanel</a>
        </nav>
        <div class="user-info">
            <span>Welcome, User123</span>
            <button>Logout</button>
        </div>
        <form class="auth-buttons" action="login.html">
            <input type="submit" value="Login"/>
            <button>Sign Up</button>
        </form>
    </header>

    <ul id="trackList">
        <!-- Тут будуть відображені треки -->
        <li><img src="icons/image.png" alt="Album Icon"><span>Track 1 </span> <button onclick="addToPlaylist('Track 1')">Додати в плейлист</button></li>
        <li><img src="icons/image.png" alt="Album Icon"><span>Track 2 </span> <button onclick="addToPlaylist('Track 2')">Додати в плейлист</button></li>
        <li><img src="icons/image.png" alt="Album Icon"><span>Track 3 </span> <button onclick="addToPlaylist('Track 3')">Додати в плейлист</button></li>
    </ul>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add Track to Playlist</h2>
            <p>Select the playlist to add the track to:</p>
            <select class="playlist-options">
                <option value="Playlist 1">Playlist 1</option>
                <option value="Playlist 2">Playlist 2</option>
                <option value="Playlist 3">Playlist 3</option>
            </select>
            <br>
            <button onclick="closeModal()">Add to Playlist</button>
        </div>
    </div>
    

    <script >
        // Функція для додавання треку до плейлисту
function addToPlaylist(trackName) {
    // Отримуємо вибраний плейлист
    const playlistSelect = document.querySelector('.playlist-options');
    const selectedPlaylist = playlistSelect.value;

    // Ajax запит для додавання треку до плейлисту
    fetch('/api/add_to_playlist', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            // Додайте CSRF токен для захисту від CSRF атак
            'X-CSRFToken': getCookie('csrftoken'),
        },
        body: JSON.stringify({
            track_name: trackName,
            playlist: selectedPlaylist
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.json();
    })
    .then(data => {
        // Ваш код для обробки успішної відповіді
        console.log('Track added to playlist:', data);
        alert('Track added to playlist successfully!');
    })
    .catch(error => {
        console.error('Error adding track to playlist:', error);
        // Ваш код для обробки помилки
        alert('Error adding track to playlist. Please try again.');
    });
}

// Функція для закриття модального вікна
function closeModal() {
    const modal = document.getElementById('modal');
    modal.style.display = 'none';
}

// Функція для отримання CSRF токена з cookie
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Отримуємо посилання на модальне вікно та кнопку закриття
const modal = document.getElementById('modal');
const closeModalButton = modal.querySelector('.close');

// Додаємо обробник кліку на кнопку закриття модального вікна
closeModalButton.addEventListener('click', () => {
    closeModal();
});

// Додаємо обробник кліку за межами модального вікна для його закриття
window.addEventListener('click', (event) => {
    if (event.target === modal) {
        closeModal();
    }
});

// Додаємо обробник клавіші Escape для закриття модального вікна
window.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
        closeModal();
    }
});

    </script>
</body>
</html>
